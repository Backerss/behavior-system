# ระบบนำเข้าข้อมูลจาก Google Sheets

## คุณสมบัติของระบบ

### 1. การดึงข้อมูลจาก Google Sheets
- ระบบสามารถดึงข้อมูลจาก Google Sheets ที่ตั้งค่าเป็น Public
- รองรับการดึงข้อมูลในรูปแบบ CSV
- ไม่ต้องติดตั้งไลบรารีเพิ่มเติม

### 2. การแสดงตัวอย่างข้อมูล (Preview)
- แสดงข้อมูลที่ถูกต้องและพร้อมนำเข้า
- แสดงข้อมูลที่ซ้ำกับฐานข้อมูล
- แสดงข้อมูลที่มีข้อผิดพลาด
- สถิติสรุปการตรวจสอบข้อมูล

### 3. การตรวจสอบข้อมูล
- ตรวจสอบความครบถ้วนของข้อมูลที่จำเป็น
- ตรวจสอบรูปแบบข้อมูล (อีเมล, โทรศัพท์, วันที่)
- ตรวจสอบข้อมูลซ้ำ (อีเมล, รหัสนักเรียน)
- ตรวจสอบความถูกต้องของบทบาท (role)

### 4. การนำเข้าข้อมูล
- เลือกข้อมูลที่ต้องการนำเข้า
- นำเข้าข้อมูลลงฐานข้อมูลแบบ Batch
- Transaction เพื่อความปลอดภัย
- รายงานผลการนำเข้า

## วิธีการใช้งาน

### สำหรับ Admin
1. เข้าสู่ระบบด้วยบัญชี Admin
2. คลิกปุ่ม "นำเข้าจาก Google Sheets" ใน Sidebar
3. คลิก "ดูตัวอย่างข้อมูล" เพื่อดึงข้อมูลจาก Google Sheets
4. ตรวจสอบข้อมูลใน 3 Tab:
   - ข้อมูลถูกต้อง (สีเขียว)
   - ข้อมูลซ้ำ (สีเหลือง)
   - ข้อมูลผิดพลาด (สีแดง)
5. เลือกข้อมูลที่ต้องการนำเข้า
6. คลิก "นำเข้าข้อมูลที่เลือก"

### การเตรียมข้อมูลใน Google Sheets
1. สร้าง Google Sheets ใหม่
2. ตั้งค่าให้เป็น Public (แชร์ให้ทุกคนดูได้)
3. กรอกข้อมูลตามคอลัมน์ที่กำหนด (ดู GOOGLE_SHEETS_EXAMPLE.md)
4. ใช้ URL ที่กำหนดไว้ในระบบ

## โครงสร้างข้อมูล

### คอลัมน์พื้นฐาน
- `prefix`: คำนำหน้าชื่อ
- `first_name`: ชื่อจริง (จำเป็น)
- `last_name`: นามสกุล (จำเป็น)
- `email`: อีเมล (จำเป็น, ไม่ซ้ำ)
- `phone`: เบอร์โทรศัพท์
- `role`: บทบาท (admin, teacher, student, guardian)

### คอลัมน์สำหรับนักเรียน
- `student_id`: รหัสนักเรียน (จำเป็น, ไม่ซ้ำ)
- `classroom`: ห้องเรียน
- `gender`: เพศ (male, female, other)
- `date_of_birth`: วันเกิด (YYYY-MM-DD)

### คอลัมน์สำหรับครู
- `employee_code`: รหัสพนักงาน
- `position`: ตำแหน่ง
- `department`: ฝ่าย/แผนก
- `major`: วิชาเอก

### คอลัมน์สำหรับผู้ปกครอง
- `relationship`: ความสัมพันธ์กับนักเรียน
- `line_id`: Line ID

## การรักษาความปลอดภัย

### สิทธิ์การเข้าถึง
- เฉพาะ Admin เท่านั้นที่สามารถใช้ฟังก์ชันนี้ได้
- ตรวจสอบสิทธิ์ทุกครั้งที่เรียกใช้ API

### การตรวจสอบข้อมูล
- ตรวจสอบข้อมูลที่อาจเป็นอันตราย (XSS, SQL Injection)
- Validation ข้อมูลก่อนบันทึก
- การใช้ Transaction ป้องกันข้อมูลเสียหาย

## การแก้ปัญหา

### ข้อผิดพลาดที่พบบ่อย
1. **ไม่สามารถดึงข้อมูลจาก Google Sheets**
   - ตรวจสอบว่า Google Sheets ตั้งค่าเป็น Public แล้ว
   - ตรวจสอบ URL ว่าถูกต้อง

2. **ข้อมูลซ้ำ**
   - ตรวจสอบอีเมลซ้ำในฐานข้อมูล
   - ตรวจสอบรหัสนักเรียนซ้ำ

3. **ข้อมูลผิดพลาด**
   - ตรวจสอบรูปแบบอีเมล
   - ตรวจสอบความครบถ้วนของข้อมูลที่จำเป็น
   - ตรวจสอบบทบาท (role) ว่าถูกต้อง

## ไฟล์ที่เกี่ยวข้อง

### Controller
- `app/Http/Controllers/GoogleSheetsImportController.php`

### View
- `resources/views/admin/google-sheets-import.blade.php`

### Service
- `app/Services/GoogleSheetsImportService.php`

### Routes
- `routes/web.php` (Google Sheets Import Routes)

### Documentation
- `GOOGLE_SHEETS_EXAMPLE.md`
- `README_GOOGLE_SHEETS_IMPORT.md`
